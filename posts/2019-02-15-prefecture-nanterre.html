<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Personal webpage and blog">
    <meta name="author" content="Björn J. Döring">
    <link rel="icon" href="../favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">

    <title>Tricking the Prefecture's Appointment Reservation System — Björn Döring</title>

    
    
    
    

    <link href="../assets/css/bdoering.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    
    <div class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../">BJÖRN DÖRING</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="../index.html">Home</a></li>
            <li><a href="../about.html">About</a></li>
	    <li><a href="../atom.xml">Feed</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">
      <h1>Tricking the Prefecture's Appointment Reservation System</h1>
<div class="info">
  Posted on February 15, 2019
  
</div>

 


<h1 id="the-challenge">The Challenge</h1>
<p>Applying for dual citizenship in France is a lengthy process. If you live around Paris in the department <a href="http://www.hauts-de-seine.fr/"><em>Hauts-de-Seine</em></a>, your first interaction with the French state will be the <em>pre accueil</em> (introductory meeting) if you apply for a <a href="http://www.hauts-de-seine.gouv.fr/Demarches-administratives/Etrangers-en-France/Naturalisation">naturalization by declaration</a> – marriage (<em>naturalisation par déclaration (mariage))</em>.</p>
<p>The challenge? You will have to <a href="http://www.hauts-de-seine.gouv.fr/Prendre-un-rendez-vous">get an appointment online</a>, but basically all places are always taken for weeks. If you cannot even hand in your documents, you are certainly not getting very far concerning your dual citizenship.</p>
<p>Is this a little scam of the French state to limit the number of applicants? They seem to have found a rather clever and indirect way of achieving this…</p>
<h1 id="the-solution">The Solution</h1>
<p>So what can you do? Either you regularly check their website to see if a new place is available, or you write a little program which does it for you. I did the second.</p>
<p>Basically, when you want to reserve a place, you are confronted with this <a href="http://www.hauts-de-seine.gouv.fr/booking/create/4485">Module de réservation</a>, an online form.</p>
<p>After checking the checkbox (acceptance of conditions) and clicking on <em>Effectuer une demande de rendez-vous</em>, you will see the following message:</p>
<blockquote>
<p>Il n’existe plus de plage horaire libre pour votre demande de rendez-vous. Veuillez recommencer ultérieurement.</p>
</blockquote>
<p>Bummer.</p>
<p>This goes on for days.</p>
<p>And days.</p>
<p>And weeks.</p>
<p>Rechecking this registration page gets old rather quickly. The little Python script below instead does it for you. Should a place be available, it will simply emit a beeping sound. The program can therefore stay running in the background and whenever a place is available, an alarm goes off.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">import</span> datetime</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="im">import</span> os</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="im">import</span> requests</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="im">import</span> sys</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="im">import</span> time</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7">URL <span class="op">=</span> <span class="st">&quot;http://www.hauts-de-seine.gouv.fr/booking/create/4485/0&quot;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># We need to look like a normal browser because otherwise we are blocked</span></a>
<a class="sourceLine" id="cb1-9" title="9">headers <span class="op">=</span> {</a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="st">'User-Agent'</span>: <span class="st">'Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:64.0) '</span> \</a>
<a class="sourceLine" id="cb1-11" title="11">    <span class="st">'Gecko/20100101 Firefox/64.0'</span></a>
<a class="sourceLine" id="cb1-12" title="12">}</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14">checkPhrase <span class="op">=</span> <span class="st">&quot;Il n'existe plus de plage horaire libre pour votre &quot;</span> \</a>
<a class="sourceLine" id="cb1-15" title="15">    <span class="st">&quot;demande de rendez-vous.&quot;</span></a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17">thisDir <span class="op">=</span> os.path.dirname(<span class="va">__file__</span>)</a>
<a class="sourceLine" id="cb1-18" title="18"></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="kw">def</span> checkPlacesAreAlreadyTaken():</a>
<a class="sourceLine" id="cb1-20" title="20">    <span class="cf">with</span> requests.Session() <span class="im">as</span> s:</a>
<a class="sourceLine" id="cb1-21" title="21">        r <span class="op">=</span> s.get(URL, headers<span class="op">=</span>headers)</a>
<a class="sourceLine" id="cb1-22" title="22">        r <span class="op">=</span> s.post(URL, headers<span class="op">=</span>headers,</a>
<a class="sourceLine" id="cb1-23" title="23">                   data<span class="op">=</span>{<span class="st">'condition'</span>:<span class="st">'on'</span>,</a>
<a class="sourceLine" id="cb1-24" title="24">                         <span class="st">'nextButton'</span>:<span class="st">'Effectuer+une+demande+de+rendez-vous'</span>})</a>
<a class="sourceLine" id="cb1-25" title="25">    <span class="cf">return</span> checkPhrase <span class="kw">in</span> r.text</a>
<a class="sourceLine" id="cb1-26" title="26"></a>
<a class="sourceLine" id="cb1-27" title="27"><span class="kw">def</span> writeResults(placesAreAlreadyTaken):</a>
<a class="sourceLine" id="cb1-28" title="28">    <span class="co">&quot;&quot;&quot;Log the result to STDOUT and to two different files.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-29" title="29">    now <span class="op">=</span> datetime.datetime.now()</a>
<a class="sourceLine" id="cb1-30" title="30">    <span class="bu">print</span>(<span class="st">'</span><span class="sc">{}</span><span class="st"> All places are already taken: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(now, placesAreAlreadyTaken))</a>
<a class="sourceLine" id="cb1-31" title="31">    <span class="cf">if</span> placesAreAlreadyTaken:</a>
<a class="sourceLine" id="cb1-32" title="32">        <span class="cf">with</span> <span class="bu">open</span>(os.path.join(thisDir, <span class="st">'placesAreAlreadyTaken.log'</span>), <span class="st">'a'</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb1-33" title="33">            f.write(<span class="st">'</span><span class="sc">{}</span><span class="st"> Places are taken</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(now))</a>
<a class="sourceLine" id="cb1-34" title="34">    <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-35" title="35">        <span class="cf">with</span> <span class="bu">open</span>(os.path.join(thisDir, <span class="st">'placeIsAvailable.log'</span>), <span class="st">'a'</span>) <span class="im">as</span> f:</a>
<a class="sourceLine" id="cb1-36" title="36">            f.write(<span class="st">'</span><span class="sc">{}</span><span class="st"> At least one place is available!</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(now))</a>
<a class="sourceLine" id="cb1-37" title="37"></a>
<a class="sourceLine" id="cb1-38" title="38"><span class="kw">def</span> playSound():</a>
<a class="sourceLine" id="cb1-39" title="39">    <span class="co">&quot;&quot;&quot;Emit three terminal beeps within 1.5 s.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-40" title="40">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</a>
<a class="sourceLine" id="cb1-41" title="41">        sys.stdout.write(<span class="st">'</span><span class="ch">\a</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb1-42" title="42">        sys.stdout.flush()</a>
<a class="sourceLine" id="cb1-43" title="43">        time.sleep(<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1-44" title="44"></a>
<a class="sourceLine" id="cb1-45" title="45"><span class="kw">def</span> main():</a>
<a class="sourceLine" id="cb1-46" title="46">    <span class="bu">print</span>(<span class="st">'Starting to monitor the reservation system.'</span>)</a>
<a class="sourceLine" id="cb1-47" title="47">    <span class="bu">print</span>(<span class="st">'Press CTRL+C to abort...</span><span class="ch">\n</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb1-48" title="48">    <span class="cf">while</span> <span class="va">True</span>:</a>
<a class="sourceLine" id="cb1-49" title="49">        <span class="cf">try</span>:</a>
<a class="sourceLine" id="cb1-50" title="50">            placesAreAlreadyTaken <span class="op">=</span> checkPlacesAreAlreadyTaken()</a>
<a class="sourceLine" id="cb1-51" title="51">        <span class="cf">except</span> requests.exceptions.RequestException <span class="im">as</span> e:</a>
<a class="sourceLine" id="cb1-52" title="52">            sys.stderr.write(<span class="st">'** Error while querying site: </span><span class="sc">{}</span><span class="ch">\n</span><span class="st">'</span>.<span class="bu">format</span>(e))</a>
<a class="sourceLine" id="cb1-53" title="53">        <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-54" title="54">            <span class="cf">if</span> <span class="kw">not</span> placesAreAlreadyTaken:</a>
<a class="sourceLine" id="cb1-55" title="55">                playSound()</a>
<a class="sourceLine" id="cb1-56" title="56">            writeResults(placesAreAlreadyTaken)</a>
<a class="sourceLine" id="cb1-57" title="57">        time.sleep(<span class="dv">10</span>)  </a>
<a class="sourceLine" id="cb1-58" title="58"></a>
<a class="sourceLine" id="cb1-59" title="59"><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</a>
<a class="sourceLine" id="cb1-60" title="60">    sys.exit(main())</a></code></pre></div>
<p>This script was written for Python 3 and tested on Linux, but there is no reason why it should not work on Windows as well.</p>
<p>After about two weeks, a place became available and I could quickly register! Maybe the script is useful to somebody else facing the same problem?</p>

<p class="text-center disqus-btn">
  <button id="btn-interact" data-toggle="button" type="button" class="btn btn-default btn-bw">
    <span class="glyphicon glyphicon-hand-down"></span>
    Interact!
  </button>
</p>

<div id="interact" class="hidden">
  <!-- Flattr button -->
  <script id="fb0cg6l">(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=bdoering&button=compact&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=20;f.width=110;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fb0cg6l');</script>
  
  
  <!-- Disqus comments -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'bdoering'; // required: replace example with your forum shortname
    (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div> <!-- interact -->

    </div><!-- /.container -->

    <div class="footer">
      <div class="container">
	<p class="text-right">Site proudly generated by <a href="http://jaspervdj.be/hakyll/">Hakyll</a>!</p>
      </div>
    </div>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../assets/js/ie10-viewport-bug-workaround.js"></script>

    <script src="../assets/js/post-interact.js"></script>


  </body>
</html>

